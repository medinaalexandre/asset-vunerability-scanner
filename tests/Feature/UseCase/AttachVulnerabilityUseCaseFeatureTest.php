<?php

use App\Models\Asset;
use App\Models\Vulnerability;
use App\Repositories\EloquentAssetRepository;
use App\Repositories\EloquentVulnerabilityRepository;
use App\UseCases\Asset\AttachVulnerabilityUseCase;

it('can attach a vulnerability to a asset', function () {
    $asset = Asset::factory()->create();
    $vulnerability = Vulnerability::factory()->create();

    $useCase = new AttachVulnerabilityUseCase(
        new EloquentAssetRepository(new Asset()),
        new EloquentVulnerabilityRepository(new Vulnerability()),
    );

    $useCase->execute($asset->getKey(), $vulnerability->getKey());

    expect($asset->vulnerabilities()->count())->toBe(1)
        ->and($asset->vulnerabilities()->first()->id)->toBe($vulnerability->id);
});
